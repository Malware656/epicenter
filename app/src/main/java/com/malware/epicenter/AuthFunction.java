package com.malware.epicenter;

import android.app.Activity;
import android.content.Intent;
import android.widget.Toast;

import com.google.android.gms.auth.api.signin.GoogleSignIn;
import com.google.android.gms.auth.api.signin.GoogleSignInAccount;
import com.google.android.gms.auth.api.signin.GoogleSignInClient;
import com.google.android.gms.auth.api.signin.GoogleSignInOptions;

public class AuthFunction {
    private static final int RC_SIGN_IN = 101;
    private final GoogleSignInClient mGoogleSignInClient;
    Toaster toaster;
    GoogleSignInAccount account;
    GoogleSignInOptions gso;
    private final Activity activity;

    public AuthFunction(Activity activity){
        this.activity = activity;

        toaster = new Toaster(activity);
        gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                .requestEmail()
                .build();
        mGoogleSignInClient = GoogleSignIn.getClient(activity, gso);
    }

    public boolean hasLoggedIn(){
        account = GoogleSignIn.getLastSignedInAccount(activity);
        return account != null;
    }

    public GoogleSignInClient getGoogleClient(){
        return mGoogleSignInClient;
    }

    public void signIn() {
        Intent signInIntent = mGoogleSignInClient.getSignInIntent();
        activity.startActivityForResult(signInIntent, RC_SIGN_IN);
    }

    public void signOut() {
        mGoogleSignInClient.signOut()
                .addOnCompleteListener(activity, task -> toaster.showToast("Logout successful", Toast.LENGTH_SHORT));
    }

}
